<%= render layout: "sources/layout", locals: { source: @source, active: :setup } do %>
  <div class="space-y-8 mt-2">
    <!-- Overview -->
    <section class="bg-gray-50 rounded-lg p-4 space-y-2">
      <p class="text-gray-600">
        <%= t("setups.show.overview_1") %>
      </p>
      <p class="text-gray-600">
        <%= t("setups.show.overview_2_html", link: link_to(t("setups.show.overview_link"), "https://github.com/aws/aws-sdk-ruby", target: "_blank", class: "text-blue-600 hover:underline")) %>
      </p>
    </section>

    <!-- Step 1: Configuration Set -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.step1_title") %></h2>
      <p class="text-gray-600 mb-3">
        <%= t("setups.show.step1_body") %>
      </p>
      <ol class="list-decimal list-inside space-y-2">
        <li><%= t("setups.show.step1_li_1_html") %></li>
        <li><%= t("setups.show.step1_li_2_html") %></li>
        <li><%= t("setups.show.step1_li_3_html") %></li>
        <li><%= t("setups.show.step1_li_4") %> <code class="bg-gray-100 px-1 rounded"><%= config_set_name(@source) %></code></li>
        <li><%= t("setups.show.step1_li_5_html") %></li>
      </ol>
    </section>

    <!-- Step 2: SNS Topic -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.step2_title") %></h2>
      <p class="text-gray-600 mb-3">
        <%= t("setups.show.step2_body") %>
      </p>
      <ol class="list-decimal list-inside space-y-2">
        <li><%= t("setups.show.step2_li_1_html") %></li>
        <li><%= t("setups.show.step2_li_2_html") %></li>
        <li><%= t("setups.show.step2_li_3_html") %></li>
        <li><%= t("setups.show.step2_li_4") %> <code class="bg-gray-100 px-1 rounded"><%= sns_topic_name(@source) %></code></li>
        <li><%= t("setups.show.step2_li_5_html") %></li>
      </ol>
    </section>

    <!-- Step 3: SNS Subscription -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.step3_title") %></h2>
      <p class="text-gray-600 mb-3">
        <%= t("setups.show.step3_body") %>
      </p>
      <ol class="list-decimal list-inside space-y-2">
        <li><%= t("setups.show.step3_li_1_html") %></li>
        <li><%= t("setups.show.step3_li_2_html") %></li>
        <li>
          <%= t("setups.show.step3_li_3") %>
          <code class="text-xs bg-gray-100 px-1 rounded"><%= webhook_url(source_token: @source.token) %></code>
        </li>
        <li><%= t("setups.show.step3_li_4_html") %></li>
        <li><%= t("setups.show.step3_li_5_html") %></li>
        <li><%= t("setups.show.step3_li_6_html") %></li>
        <li><%= t("setups.show.step3_li_7") %></li>
      </ol>
    </section>

    <!-- Step 4: Event Destination -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.step4_title") %></h2>
      <p class="text-gray-600 mb-3">
        <%= t("setups.show.step4_body") %>
      </p>
      <ol class="list-decimal list-inside space-y-2">
        <li><%= t("setups.show.step4_li_1_html") %></li>
        <li><%= t("setups.show.step4_li_2") %> <code class="bg-gray-100 px-1 rounded"><%= config_set_name(@source) %></code></li>
        <li><%= t("setups.show.step4_li_3_html") %></li>
        <li><%= t("setups.show.step4_li_4_html") %></li>
        <li>
          <%= t("setups.show.step4_li_5") %>
          <ul class="list-disc list-inside ml-4 mt-1 text-gray-600">
            <li><%= t("setups.show.step4_events.sends_html") %></li>
            <li><%= t("setups.show.step4_events.deliveries_html") %></li>
            <li><%= t("setups.show.step4_events.bounces_html") %></li>
            <li><%= t("setups.show.step4_events.complaints_html") %></li>
            <li><%= t("setups.show.step4_events.opens_html") %></li>
            <li><%= t("setups.show.step4_events.clicks_html") %></li>
            <li><%= t("setups.show.step4_events.delivery_delays_html") %></li>
            <li><%= t("setups.show.step4_events.rejections_html") %></li>
          </ul>
        </li>
        <li><%= t("setups.show.step4_li_6_html") %></li>
        <li><%= t("setups.show.step4_li_7_html") %></li>
        <li><%= t("setups.show.step4_li_8_html", name: capture { %><code class="bg-gray-100 px-1 rounded"><%= sns_topic_name(@source) %></code><% }) %></li>
        <li><%= t("setups.show.step4_li_9_html") %></li>
        <li><%= t("setups.show.step4_li_10_html") %></li>
      </ol>
    </section>

    <!-- Step 5: Use the Configuration Set -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.step5_title") %></h2>
      <p class="text-gray-600 mb-3">
        <%= t("setups.show.step5_body") %>
      </p>

      <div>
        <p class="font-medium mb-2">
          <%= t("setups.show.step5_sdk_title_html", link: link_to("aws-sdk-sesv2", "https://github.com/aws/aws-sdk-ruby", target: "_blank", class: "text-blue-600 hover:underline")) %>
        </p>
        <pre class="rounded text-xs overflow-x-auto"><code class="language-ruby" data-controller="highlight">ses.send_email(
  from_email_address: "you@example.com",
  destination: { to_addresses: ["user@example.com"] },
  content: { ... },
  configuration_set_name: "<%= config_set_name(@source) %>"
)</code></pre>
      </div>

      <div class="mt-6">
        <p class="font-medium mb-2">
           <%= t("setups.show.step5_rails_title_html", link: link_to("aws-actionmailer-ses", "https://github.com/aws/aws-actionmailer-ses-ruby", target: "_blank", class: "text-blue-600 hover:underline")) %>
        </p>
        <p class="text-gray-600 mb-3"><%= t("setups.show.step5_rails_global") %></p>
        <pre class="rounded text-xs overflow-x-auto"><code class="language-ruby" data-controller="highlight">class ApplicationMailer < ActionMailer::Base
  default "X-SES-CONFIGURATION-SET" => "<%= config_set_name(@source) %>"
end</code></pre>
        <p class="text-gray-600 mt-4 mb-3"><%= t("setups.show.step5_rails_method") %></p>
        <pre class="rounded text-xs overflow-x-auto"><code class="language-ruby" data-controller="highlight">class UserMailer < ApplicationMailer
  def welcome(user)
    headers["X-SES-CONFIGURATION-SET"] = "<%= config_set_name(@source) %>"
    mail(to: user.email, subject: "Welcome!")
  end
end</code></pre>
      </div>
    </section>

    <!-- Verification -->
    <section class="bg-gray-50 rounded-lg p-5">
      <h2 class="text-lg font-semibold mb-2"><%= t("setups.show.verify_title") %></h2>
      <p class="text-gray-600">
        <%= t("setups.show.verify_body_html", link: link_to(t("setups.show.verify_link"), source_events_path(@source), class: "text-blue-600 hover:underline")) %>
      </p>
    </section>
  </div>
<% end %>
